<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leeton Golf 18-Hole Tracker</title>
  <style>
    body { font-family: Arial; margin:0; background:#f0f0f0; }
    header { display:flex; justify-content:space-between; align-items:center; padding:1rem; background:#2c3e50; color:#fff; }
    svg { border:2px solid #333; background:#cce5cc; display:block; margin:0 auto; }
    #distance { padding:1rem; font-size:1.2rem; text-align:center; }
    #scorecard { padding:1rem; max-width:400px; margin:0 auto 2rem; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.2); }
    .score-hole { display:flex; justify-content:space-between; padding:0.2rem 0; }
    .score-hole input { width:40px; }
  </style>
</head>
<body>
  <div id="app">
    <header>
      <h1>Leeton Golf Tracker</h1>
      <select id="holeSelect"></select>
    </header>
    <svg id="courseSVG" width="100%" height="500px"></svg>
    <div id="distance">Distance to green: -- m</div>
    <div id="scorecard">
      <h2>Scorecard</h2>
      <div id="scores"></div>
    </div>
  </div>
  <script>
    let holesData;
    let currentHoleIndex = 0;
    let svg, holeSelect;
    let player = {x:50, y:400};
    let scores = Array(18).fill(0);

    window.onload = async () => {
      svg = document.getElementById('courseSVG');
      holeSelect = document.getElementById('holeSelect');

      // Load holes
      holesData = await fetch('data/holes.json').then(r=>r.json());

      // Populate hole selector
      holesData.forEach((h,i)=>{
        let opt = document.createElement('option');
        opt.value = i;
        opt.text = `Hole ${h.hole} - Par ${h.par}`;
        holeSelect.appendChild(opt);
      });

      holeSelect.addEventListener('change', (e)=>{
        currentHoleIndex = parseInt(e.target.value);
        drawHole();
        updateDistance();
        renderScorecard();
      });

      drawHole();
      updateDistance();
      renderScorecard();

      // GPS / simulation
      if(navigator.geolocation){
        navigator.geolocation.watchPosition(pos=>{
          player.x = pos.coords.longitude%800;
          player.y = pos.coords.latitude%500;
          drawHole();
          updateDistance();
        });
      } else {
        setInterval(()=>{
          player.x += 1; if(player.x>800) player.x=50;
          drawHole(); updateDistance();
        },1000);
      }
    };

    function drawHole(){
      svg.innerHTML = '';
      const hole = holesData[currentHoleIndex];

      // fairway
      let fairway = document.createElementNS("http://www.w3.org/2000/svg","polygon");
      fairway.setAttribute("points", hole.fairway.map(p=>p.join(',')).join(' '));
      fairway.setAttribute("fill","#77cc77");
      svg.appendChild(fairway);

      // bunkers
      hole.bunkers.forEach(b=>{
        let bunker = document.createElementNS("http://www.w3.org/2000/svg","polygon");
        bunker.setAttribute("points", b.map(p=>p.join(',')).join(' '));
        bunker.setAttribute("fill","#d2b48c");
        svg.appendChild(bunker);
      });

      // green
      let green = document.createElementNS("http://www.w3.org/2000/svg","circle");
      green.setAttribute("cx", hole.green.center[0]);
      green.setAttribute("cy", hole.green.center[1]);
      green.setAttribute("r", hole.green.radius);
      green.setAttribute("fill","#339933");
      svg.appendChild(green);

      // tee
      let tee = document.createElementNS("http://www.w3.org/2000/svg","circle");
      tee.setAttribute("cx", hole.tee[0]);
      tee.setAttribute("cy", hole.tee[1]);
      tee.setAttribute("r",5);
      tee.setAttribute("fill","#ff0000");
      svg.appendChild(tee);

      // player
      let dot = document.createElementNS("http://www.w3.org/2000/svg","circle");
      dot.setAttribute("cx", player.x);
      dot.setAttribute("cy", player.y);
      dot.setAttribute("r",5);
      dot.setAttribute("fill","#0000ff");
      svg.appendChild(dot);

      // pin
      let pin = document.createElementNS("http://www.w3.org/2000/svg","circle");
      pin.setAttribute("cx", hole.green.center[0]);
      pin.setAttribute("cy", hole.green.center[1]);
      pin.setAttribute("r",3);
      pin.setAttribute("fill","#ffff00");
      svg.appendChild(pin);
    }

    function updateDistance(){
      const hole = holesData[currentHoleIndex];
      let dx = player.x - hole.green.center[0];
      let dy = player.y - hole.green.center[1];
      let dist = Math.sqrt(dx*dx + dy*dy);
      document.getElementById('distance').innerText = `Distance to green: ${Math.round(dist)} m`;
    }

    function renderScorecard(){
      let scoresDiv = document.getElementById('scores');
      scoresDiv.innerHTML = '';
      holesData.forEach((h,i)=>{
        let div = document.createElement('div');
        div.className = 'score-hole';
        div.innerHTML = `<span>Hole ${h.hole} (Par ${h.par})</span>
        <input type="number" min="0" value="${scores[i]}" data-index="${i}">`;
        scoresDiv.appendChild(div);
      });
      scoresDiv.querySelectorAll('input').forEach(input=>{
        input.addEventListener('change', e=>{
          let idx = parseInt(e.target.dataset.index);
          scores[idx] = parseInt(e.target.value);
        });
      });
    }
  </script>
</body>
</html>
